{
    "contents" : "#library(parallel)\n\n# To find siliar artchitypes\ncomb <- readRDS(\"data/combined_2013_arch.Rds\")\nsel <- comb[,c(\"aacode\",\"aagpd1213\",\"archcode\",\"energytyp\",\"generaltyp\",\"rooftyp\",\"solartyp\",\"walltyp\",\"wintyp\",\"floortyp\")]\nrm(comb)\n\nsel <- sel[with(sel, order(rooftyp,solartyp,walltyp,wintyp,floortyp)),]\nsel$generaltyp2 <- substr(sel$generaltyp,1,1)\nsel$subcode <- paste0(sel$generaltyp2,sel$walltyp,sel$floortyp,sel$rooftyp,sel$solartyp,sel$wintyp, sel$energytyp)\n\nsum(sel$aagpd1213) #23253781\n\ngrp <- data.frame(id = unique(sel$subcode), nhouse = NA)\ngrp$id <- as.character(grp$id)\n\nfor(b in 1:nrow(grp)){\n  grp$nhouse[b] <- sum(sel$aagpd1213[sel$subcode == grp$id[b]]) \n}\n\nsum(sel$aagpd1213) #23253781\n\n\ngrp <- grp[order(-grp$nhouse),]\ncsum <- cumsum(grp$nhouse)\ncheck <- csum < sum(grp$nhouse) * 0.8\nplot(csum)\n\nsum(sel$aagpd1213[sel$subcode %in% grp$id]) #23253781\nsum(grp$nhouse)#23253781\n\ngrp_sub <- grp[check,]\ncsum2 <- cumsum(grp_sub$nhouse)\npoints(csum2, col = \"Red\")\n\nsum(sel$aagpd1213[sel$subcode %in% grp_sub$id]) #18541922\n\ngrp_sub$strip <- substr(grp_sub$id,2,7)\n\ngrp2 <- data.frame(id = unique(grp_sub$strip), nhouse = NA)\nfor(b in 1:nrow(grp2)){\n  grp2$nhouse[b] <- sum(grp_sub$nhouse[grp_sub$strip == grp2$id[b]]) \n} \n\nsum(grp2$nhouse) #18541922\n\nsel$strip <- paste0(sel$walltyp,sel$floortyp,sel$rooftyp,sel$solartyp,sel$wintyp,sel$energytyp)\n\n\nrow <- grp2$id #To do without energy\nrow <- as.character(row)\ncol <- unique(sel$generaltyp2)\n\n\nnrow <- length(row)\nncell <-  nrow * 8\n\n#Do as lapply\ncountarch <- function(i){\n  x <- if(i %% nrow == 0){nrow}else{i %% nrow}\n  y <- ((i-1) %/% nrow) + 1\n  yid <- col[y]\n  xid <- row[x]\n  res <- sum(sel$aagpd1213[sel$generaltyp2 == yid & sel$strip == xid]) # With out energy\n  #res <- sum(sel$aagpd1213[sel$generaltyp2 == yid & sel$subcode == xid]) # With energy\n  return(res)\n}\n\n\ncompare <- lapply(1:ncell,countarch)\ncompare <- matrix(unlist(compare), ncol = 8, byrow = FALSE)\ncompare <- as.data.frame(compare)\nnames(compare) <- col\nrownames(compare) <- row\nsum(compare) \n\ncompare$total <- rowSums(compare)\ncompare <- compare[order(-compare$tota),]\n\ncsum3 <- cumsum(compare$total)\npoints(csum3, col = \"Green\")\n\nstop()\n\n###########################################################################\n\n\n\n\n\n#Do as lapply\ncountsimilar <- function(i){\n  x <- if(i %% nrow == 0){nrow}else{i %% nrow}\n  y <- ((i-1) %/% nrow) + 1\n  yid <- uni$subcode[y]\n  xid <- uni$subcode[x]\n  xval <- uni[uni$subcode == xid,]\n  yval <- uni[uni$subcode == yid,]\n  res <- sum(xval$energytyp == yval$energytyp, xval$rooftyp == yval$rooftyp, xval$solartyp == yval$solartyp, xval$walltyp == yval$walltyp, xval$wintyp == yval$wintyp, xval$floortyp == yval$floortyp)\n  return(res)\n}\n\ncompare <- lapply(1:ncell,countsimilar)\ncompare <- matrix(unlist(compare), ncol = nrow, byrow = FALSE)\ncompare <- as.data.frame(compare)\nnames(compare) <- uni$subcode\nrownames(compare) <- uni$subcode\n\nsaveRDS(compare,\"data/archetypes_comparion3.Rds\")\nrm(nrow,ncell,x,y,yid,xid,xval,yval, uni, i)\n\n\n\n\n#Sort by count then group with simialr architypes\nrowcount <- data.frame(id = names(compare), sum=rowSums(compare)) #This one for editing\ngroups <- data.frame(id = names(compare), sum=rowSums(compare) ,group=NA, ndwel=NA) # this one to store\nrowcount <- rowcount[order(-rowcount$sum),] # Sort\ngroups$id <- as.character(groups$id)\n\n#Add in the numebr of dwellings\n\nfor(b in 1:nrow(groups)){\n  groups$ndwel[b] <- sum(sel$aagpd1213[sel$subcode == groups$id[b]]) \n}\n\n\n#Group the Architypes\nfor(a in 1:99999){\n  id <- as.character(rowcount$id[1])\n  sub <- as.data.frame(compare[,id, drop = FALSE])\n  names(sub) <- c(\"res\")\n  sub <- sub[sub$res >=5,,drop = FALSE]\n  getids <- rownames(sub)\n  groups$group[groups$id %in% getids] <- a\n  rowcount <- rowcount[!(rowcount$id %in% getids),]\n  if(nrow(rowcount) == 0){\n    break\n  }\n}\nrm(a, id,sub, getids)\n\n\n#Count the number of dwellings in each group\ngroupsums <- data.frame(group = groups$group[!duplicated(groups$group)], ndwel = NA)\nfor(c in 1:nrow(groupsums)){\n  groupsums$ndwel[c] <- sum(groups$ndwel[groups$group == groupsums$group[c]])\n}\nrm(c)\n\ngroupsums <- groupsums[order(-groupsums$ndwel),]\n\ncsum <- cumsum(groupsums$ndwel)\nplot(csum, ylab = \"Number of Houses\", xlab = \"Number of Archetype Groups\")\n\n#Add in architype codes\ngroupsums$arch <- NA\nfor(d in 1:nrow(groupsums)){\n  groupsums$arch[d] <- groups$id[groups$group == groupsums$group[d]][1]\n}\n\n\n#uni$count <- NA\n#uni$countsamp <- NA\n#uni$conf <- NA\n#for (f in 1:nrow(uni)){\n#  uni$count[f] <- sum(sel$aagpd1213[sel$archcode == uni$archcode[f] ])\n#  uni$countsamp[f] <- nrow(sel[sel$archcode == uni$archcode[f]  , ])\n#  uni$conf[f] <- uni$count[f] / uni$countsamp[f]\n#}\n\n\n\n\n\n",
    "created" : 1495024604679.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1472682782",
    "id" : "4DE15AEF",
    "lastKnownWriteTime" : 1497352655,
    "path" : "C:/Users/earmmor/Git/glider/Glider/code/similar_archetypes.R",
    "project_path" : "code/similar_archetypes.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}