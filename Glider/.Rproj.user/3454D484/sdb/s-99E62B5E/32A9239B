{
    "contents" : "#Read in EHS and convert to RDS\nlibrary(foreign)\nlibrary(dplyr, lib.loc = \"M:/R/R-3.3.1/library\")\nlibrary(lazyeval, lib.loc = \"M:/R/R-3.3.1/library\")\ncurrent_year <- 2013\n\n\ninfld <- \"C:/Users/earmmor/OneDrive/OD/Glider - Private/WP2/Data/EHS/EHS-2013-SPSS/UKDA-7802-spss/spss/spss19/\"\n###############################################################################\n#Physical Table\n##############################################################################\nphysical <- read.spss(paste0(infld,\"derived/physical_12and13.sav\"),to.data.frame=TRUE)\nphysical <- physical[,c(\"aacode\",\"dwtypenx\",\"dwage9x\",\"floorx\",\"floor5x\",\"storeyx\",\"typerstr\",\n                        \"typewstr2\",\"constx\",\"typewfin\",\"typewin\",\"dblglaz4\",\"arnatx\",\"attic\",\n                        \"basement\",\"heat7x\",\"sysage\",\"mainfuel\",\"watersys\",\"boiler\",\n                        \"wallinsy\",\"sap12\")]\nphysical$aacode <- as.character(physical$aacode)\n#############################################################################\n#General Table\n###########################################################################\ngeneral <- read.spss(paste0(infld,\"derived/general_12and13.sav\"),to.data.frame=TRUE)\ngeneral <- general[,c(\"aacode\",\"aagpd1011\",\"tenure4x\",\"GorEHCS\",\"imd1010\")]\nnames(general) <- c(\"aacode\",\"aagpd1213\",\"tenure4x\",\"GorEHCS\",\"imd\")\ngeneral$aacode <- as.character(general$aacode)\n##########################################################################\n#elevate Table\n####################################################################\nelevate <- read.spss(paste0(infld,\"physical/elevate.sav\"),to.data.frame=TRUE)\nelevate <- elevate[,c( \"aacode\",\"Felsolff\",\"Felpvff\",\n                                \"Felsollf\",\"Felpvlf\",\n                                \"Felsolrf\",\"Felpvrf\",\n                                \"Felsolbf\",\"Felpvbf\",\n                                \"felroofp\",\"Fvwpvbf\",\"Fvwpvlf\",\"Fvwpvrf\",\"Fvwpvff\")]\nelevate$aacode <- as.character(elevate$aacode)\n############################################################################\n#Services Table\n############################################################################\nservices <- read.spss(paste0(infld,\"physical/services.sav\"),to.data.frame=TRUE)\nservices <- services[,c(\"aacode\",\"Finchtyp\",\"Finmhfue\",\"Finmhboi\",\"Finchbag\",\n                        \"Finchoff\",\"Finchthe\",\"Finchtim\",\"Finchove\",\"Finchrom\",\"Finchcon\",\"Finchtrv\",\"Finchtzc\",\"Finchdst\",\n                        \"Finoheat\",\"Finohtyp\",\n                        \"Finwhoac\",\"Finwhxpr\",\"Finwhxty\",\"Finwhxag\",\n                        \"Finwsipr\",\"Finwsiag\",\"Finwdipr\",\"Finwdiag\",\n                        \"Finwsppr\",\"Finwspty\",\"Finwspag\",\n                        \"Finwmppr\",\"Finwmpty\",\"Finwmpag\",\n                        \"Finwhlpr\",\"Finwhlag\",\n                        \"Finwhcyl\",\"Finwhins\",\"Finwhmms\",\n                        \"Finwhcen\",\"Finwhthe\",\"Finlopos\",\"Flitypes\",\"Fliinsul\",\"Finintyp\",\"Flithick\")]\nservices$aacode <- as.character(services$aacode)\n#########################################################################\n#Combine\n########################################################################\ncombined <- left_join(physical,general, by = \"aacode\")\ncombined <- left_join(combined,services, by = \"aacode\")\ncombined <- left_join(combined,elevate, by = \"aacode\")\n#remove(physical,general,services,elevate)\n\n#######################################################################\n#roof table\n########################################################################\nroof <- combined[,c(\"aacode\",\"typerstr\",\"Flitypes\",\"Fliinsul\",\"Finintyp\",\"Flithick\",\"attic\",\n                    \"Felsolff\",\"Felpvff\",\n                    \"Felsollf\",\"Felpvlf\",\n                    \"Felsolrf\",\"Felpvrf\",\n                    \"Felsolbf\",\"Felpvbf\",\n                    \"felroofp\",\"Fvwpvbf\",\"Fvwpvlf\",\"Fvwpvrf\",\"Fvwpvff\",\n                    \"floorx\",\"storeyx\",\"dwtypenx\")]\n\n#Remove NAs\nrem_na <- function(col){\n  for(x in 1:length(col)){\n    if(is.na(col[x])){\n      col[x]<- \"No\"\n    }\n  } \n  return(col)\n}\n\nroof$Felpvff <- rem_na(roof$Felpvff)\nroof$Felpvbf <- rem_na(roof$Felpvbf)\nroof$Felpvlf <- rem_na(roof$Felpvlf)\nroof$Felpvrf <- rem_na(roof$Felpvrf)\nroof$Felsolff <- rem_na(roof$Felsolff)\nroof$Felsolbf <- rem_na(roof$Felsolbf)\nroof$Felsollf <- rem_na(roof$Felsollf)\nroof$Felsolrf <- rem_na(roof$Felsolrf)\nroof$Fvwpvff <- rem_na(roof$Fvwpvff)\nroof$Fvwpvbf <- rem_na(roof$Fvwpvbf)\nroof$Fvwpvlf <- rem_na(roof$Fvwpvlf)\nroof$Fvwpvrf <- rem_na(roof$Fvwpvrf)\n\n\n#Summarise PV\nroof$PV <- NA\nfor(i in 1:nrow(roof)){\n  if((roof$Felpvff[i] == \"Yes\") || (roof$Felpvbf[i] == \"Yes\") || (roof$Felpvlf[i] == \"Yes\") || (roof$Felpvrf[i] == \"Yes\")){\n    roof$PV[i] <- \"Yes\"\n  }else{\n    roof$PV[i] <- \"No\"\n    }\n}\n\n#Summarise Solar\nroof$Solar <- NA\nfor(j in 1:nrow(roof)){\n  if((roof$Felsolff[j] == \"Yes\") || (roof$Felsolbf[j] == \"Yes\") || (roof$Felsollf[j] == \"Yes\") || (roof$Felsolrf[j] == \"Yes\")){\n    roof$Solar[j] <- \"Yes\"\n  }else{\n    roof$Solar[j] <- \"No\"\n  }\n}\n\n#Summarise Suitability\nroof$SolarSuit <- NA\nfor(k in 1:nrow(roof)){\n  if((roof$Fvwpvff[k] == \"Yes\") || (roof$Fvwpvbf[k] == \"Yes\") || (roof$Fvwpvlf[k] == \"Yes\") || (roof$Fvwpvrf[k] == \"Yes\")){\n    roof$SolarSuit [k] <- \"Yes\"\n  }else{\n    roof$SolarSuit [k] <- \"No\"\n  }\n}\n\n#Summaries Loft Insulation\n#Standerside Thickenss and Materials \nroof$LoftIns <-NA\nroof$Flithick <- as.character(roof$Flithick)\nroof$Flithick <- rem_na(roof$Flithick)\n\nfor(b in 1:nrow(roof)){\n  if(roof$Flithick[b] == \"300mm\" | roof$Flithick[b] == \">300mm\" | roof$Flithick[b] == \"250mm\"){\n    roof$LoftIns[b] <-\"Well Insulated\"\n  } else if (roof$Flithick[b] == \"25mm\" | roof$Flithick[b] == \"50mm\" | roof$Flithick[b] == \"75mm\" | roof$Flithick[b] == \"100mm\" | roof$Flithick[b] == \"125mm\" | roof$Flithick[b] == \"150mm\" | roof$Flithick[b] == \"200mm\"){\n    roof$LoftIns[b] <-\"Poorly Insulated\"\n  } else {\n    roof$LoftIns[b] <-\"No Insulation\"\n  }\n}\n\n\n\n#Plot\ncounts <- table(roof$LoftIns)\nbarplot(counts, main=\"Loft Insualtion\", ylab=\"Number of Dwellings\")\n\n#Calcualte Roof Area\nroof$roofarea <- NA\nfor(e in 1:nrow(roof)){\n  if(roof$dwtypenx[e] == \"end terrace\" | roof$dwtypenx[e] == \"mid terrace\"|roof$dwtypenx[e] == \"semi detached\"|roof$dwtypenx[e] == \"detached\"|roof$dwtypenx[e] == \"bungalow\"){\n    roof$roofarea[e] <- roof$floorx[e] / roof$storeyx[e]\n  } else {\n    roof$roofarea[e] <- roof$floorx[e]\n  }\n}\n\nhist(roof$roofarea, c(0,30,50,80,100,115,450))\nsolfacts <- read.csv(\"data/solarrooffactors.csv\", row.names = c(\"end terrace\",\"mid terrace\",\"semi detached\",\"detached\",\"bungalow\",\"converted flat\",\"purpose built flat, low rise\",\"purpose built flat, high rise\"), col.names = c(\"mixed types\",\"pitched\",\t\"mansard\",\t\"flat\",\t\"chalet\"), header = F)\n\n#Calcualte Useable Area for solar\nroof$solfactor <- NA\nfor(f in 1:nrow(roof)){\n  roof$solfactor[f] <- solfacts[roof$dwtypenx[f],roof$typerstr[f]]\n}\nroof$solarea <- NA\nfor(e in 1:nrow(roof)){\n  x <- roof$roofarea[e] * roof$solfactor[e]\n  if(x < 10){\n    roof$solarea[e] <- \"<10 sqm\"\n  }else if(x >= 10 & x < 15){\n    roof$solarea[e] <- \"10 to 15 sqm\"\n  }else if(x >= 15 & x < 20){\n    roof$solarea[e] <- \"15 to 20 sqm\"\n  }else if(x >= 20 & x < 25){\n    roof$solarea[e] <- \"20 to 25 sqm\"\n  }else if(x >= 25 & x < 30){\n    roof$solarea[e] <- \"25 to 30 sqm\"\n  }else if(x >= 30 & x <= 35){\n    roof$solarea[e] <- \"30 to 35 sqm\"\n  }else{\n    roof$solarea[e] <- \">35 sqm\"\n  }\n}\nroof$solarea <- as.factor(roof$solarea)\n#Plot\ncounts <- table(roof$solarea)\nbarplot(counts, main=\"Roof area for solar pannels\", ylab=\"Number of Dwellings\")\n\n\n\nroof <- roof[,c(\"aacode\",\"typerstr\",\"attic\",\"PV\",\"Solar\",\"SolarSuit\",\"LoftIns\",\"solarea\")]\n\n##########################################################################\n#Walls Table\n###########################################################################\nwalls <- combined[,c(\"aacode\",\"typewstr2\",\"wallinsy\")]\n\n\n\n#Plot\ncounts <- table(walls$wallinsy)\nbarplot(counts, main=\"External Wall Insualtion\", ylab=\"Number of Dwellings\")\n\n############################################################################################\n#Shape Table\n###########################################################################################\nshape <- combined[,c(\"aacode\",\"dwtypenx\",\"dwage9x\",\"floorx\",\"floor5x\",\"storeyx\",\"basement\",\"Finlopos\")]\n#shape$type <- as.factor(paste0(shape$Finlopos,\" \",shape$dwtypenx))\n#summary(shape$type)\nshape$type <- NA\nfor (c in 1:nrow(shape)){\n  if(shape$Finlopos[c] == \"Basement Flat\"){\n    shape$type[c] <- paste0(\"Basement \",shape$dwtypenx[c])\n  }else if(shape$Finlopos[c] == \"Mid Floor Flat\"){\n    shape$type[c] <- paste0(\"Mid Floor \",shape$dwtypenx[c])\n  }else if(shape$Finlopos[c] == \"Top Floor Flat\"){\n    shape$type[c] <- paste0(\"Top Floor \",shape$dwtypenx[c])\n  }else if(shape$Finlopos[c] == \"Ground floor flat\"){\n    shape$type[c] <- paste0(\"Ground floor \",shape$dwtypenx[c])\n  }else if(shape$Finlopos[c] == \"House/Bungalow\" & shape$dwtypenx[c] == \"bungalow\"){\n    shape$type[c] <- paste0(shape$dwtypenx[c])\n  }else if(shape$Finlopos[c] == \"House/Bungalow\" & shape$dwtypenx[c] != \"bungalow\"){\n    shape$type[c] <- paste0(shape$dwtypenx[c])\n  }\n}\nshape$type <- as.factor(shape$type)\n\n\n#Plot\ncounts <- table(shape$type)\nbarplot(counts, main=\"Building Type\", ylab=\"Number of Dwellings\",las=2)\n\n\n#Create an exact age\nshape$age <- NA\nfor(r in 1:nrow(shape)){\n  if(shape$dwage9x[r] == \"pre 1850\"){\n    shape$age[r] <- 1849\n  }else if (shape$dwage9x[r] == \"1850 to 1899\"){\n    shape$age[r] <- sample(1850:1899, 1)\n  }else if (shape$dwage9x[r] == \"1900 to 1918\"){\n    shape$age[r] <- sample(1900:1918, 1)\n  }else if (shape$dwage9x[r] == \"1919 to 1944\"){\n    shape$age[r] <- sample(1919:1944, 1)\n  }else if (shape$dwage9x[r] == \"1945 to 1964\"){\n    shape$age[r] <- sample(1945:1964, 1)\n  }else if (shape$dwage9x[r] == \"1965 to 1974\"){\n    shape$age[r] <- sample(1965:1974, 1)\n  }else if (shape$dwage9x[r] == \"1975 to 1980\"){\n    shape$age[r] <- sample(1975:1980, 1)\n  }else if (shape$dwage9x[r] == \"1981 to 1990\"){\n    shape$age[r] <- sample(1981:1990, 1)\n  }else if (shape$dwage9x[r] == \"post 1990\"){\n    shape$age[r] <- sample(1990:2013, 1)\n  }else {\n    shape$age[r] <- 0\n  }\n}\n\n#Remove Unneeded Columns\nrems <- !names(shape) %in% c(\"Finlopos\",\"floorx\",\"storeyx\")\nshape <- shape[,rems]\n\n############################################################################\n#Context Table\n###########################################################################\ncontext <- combined[c(\"aacode\",\"aagpd1213\",\"tenure4x\",\"GorEHCS\",\"imd\",\"arnatx\")]\n\n\n\n#########################################################################\n#Energy Table\n##########################################################################\nenergy <- combined[c(\"aacode\",\"Finchtyp\",\"mainfuel\",\"Finmhboi\",\"Finchbag\",\"sysage\",\"watersys\",\n                     \"Finchoff\",\"Finchthe\",\"Finchtim\",\"Finchove\",\"Finchrom\",\"Finchcon\",\"Finchtrv\",\"Finchtzc\",\"Finchdst\",\n                     \"Finwsipr\",\"Finwsiag\",\"Finwdipr\",\"Finwdiag\",\n                     \"Finwsppr\",\n                     \"Finwmppr\",\n                     \"Finwhcyl\",\"Finwhins\",\"Finwhmms\"\n                     )]\n\n#Remove Nulls from Controls\n\nenergy$Finchoff <- rem_na(energy$Finchoff) #On/Off\nenergy$Finchtim <- rem_na(energy$Finchtim) #central timer\nenergy$Finchthe <- rem_na(energy$Finchthe) #Boiler Thermostat\nenergy$Finchove <- rem_na(energy$Finchove) #Manual Overide\nenergy$Finchrom <- rem_na(energy$Finchrom) #Room Thermostat\nenergy$Finchcon <- rem_na(energy$Finchcon) #Radiator Control\nenergy$Finchtrv <- rem_na(energy$Finchtrv) #Thermostatic Radiator Conrol\nenergy$Finchtzc <- rem_na(energy$Finchtzc) #Time and Temp Zone\nenergy$Finchdst <- rem_na(energy$Finchdst) #Delayed Start\n\nenergy$control <- NA\n\n# Energy Control Levle cumulative number of controls had\n#L7 - Delay Start, L6 - Time and temp zones, L5 - Room Thermostat, L4 - Boiler Thermostat, L3 - Manual Overide, L2 - Central Timer, L1 - On/Off, L0 - None, L9 - Other combination\n\nfor(l in 1:nrow(energy)){\n  if(energy$Finchtim[l] == \"Yes\" && energy$Finchdst[l] == \"Yes\" && energy$Finchtzc[l] == \"Yes\" && energy$Finchrom[l] == \"Yes\" && energy$Finchthe[l] == \"Yes\" && energy$Finchove[l] == \"Yes\" && energy$Finchoff[l] == \"Yes\"){\n    energy$control[l] <- 7\n  } else if (energy$Finchtim[l] == \"Yes\" && energy$Finchtzc[l] == \"Yes\" && energy$Finchrom[l] == \"Yes\" && energy$Finchthe[l] == \"Yes\" && energy$Finchove[l] == \"Yes\" && energy$Finchoff[l] == \"Yes\"){\n    energy$control[l] <- 6\n  } else if (energy$Finchtim[l] == \"Yes\" && energy$Finchrom[l] == \"Yes\" && energy$Finchthe[l] == \"Yes\" && energy$Finchove[l] == \"Yes\" && energy$Finchoff[l] == \"Yes\"){\n    energy$control[l] <- 5\n  } else if (energy$Finchtim[l] == \"Yes\" && energy$Finchthe[l] == \"Yes\" && energy$Finchove[l] == \"Yes\" && energy$Finchoff[l] == \"Yes\"){\n    energy$control[l] <- 4\n  } else if (energy$Finchtim[l] == \"Yes\" && energy$Finchove[l] == \"Yes\" && energy$Finchoff[l] == \"Yes\"){\n    energy$control[l] <- 3\n  } else if (energy$Finchtim[l] == \"Yes\" && energy$Finchoff[l] == \"Yes\"){\n    energy$control[l] <- 2\n  } else if (energy$Finchoff[l] == \"Yes\"){\n    energy$control[l] <- 1    \n  } else if (energy$Finchtim[l] == \"No\" && energy$Finchdst[l] == \"No\" && energy$Finchtzc[l] == \"No\" && energy$Finchrom[l] == \"No\" && energy$Finchthe[l] == \"No\" && energy$Finchove[l] == \"No\" && energy$Finchoff[l] == \"No\"){\n    energy$control[l] <- 0\n  } else {\n    energy$control[l] <- 9\n  }\n}\n\ncounts <- table(energy$control)\nbarplot(counts, main=\"Control Level\", ylab=\"Number of Dwellings\")\n\n#Radiator Control Level\n#L2 - TRVs, L1 - Controls, L0 - None\n\nenergy$radcontrol <- NA\nfor(m in 1:nrow(energy)){\n  if(energy$Finchtrv[m] == \"Yes\"){\n    energy$radcontrol[m] <- 2\n  } else if (energy$Finchtrv[m] == \"No\" && energy$Finchcon[m] == \"Yes\"){\n    energy$radcontrol[m] <- 1\n  } else {\n    energy$radcontrol[m] <- 0\n  }\n}\n\n#Plot\ncounts <- table(energy$radcontrol)\nbarplot(counts, main=\"Radiator Control Level\", ylab=\"Number of Dwellings\")\n\n\n#Remove Unneeded Columns\nrems <- !names(energy) %in% c(\"Finchtim\",\"Finchoff\",\"Finchthe\",\"Finchove\",\"Finchrom\",\"Finchcon\",\"Finchtrv\",\"Finchtzc\",\"Finchdst\")\nenergy <- energy[,rems]\n\n#Simplify Water Cylinder and Imersion Heater\n\nenergy$Finwsipr <- rem_na(energy$Finwsipr) #Single Immersion\nenergy$Finwdipr <- rem_na(energy$Finwdipr) #Dual Immersion\nenergy$Finwhcyl <- rem_na(energy$Finwhcyl) #Water Cyclinder\n\nenergy$tank <-NA\nenergy$immersage <- NA\nfor(n in 1:nrow(energy)){\n  if((energy$Finwsipr[n] == \"Yes\" || energy$Finwdipr[n] == \"Yes\") && energy$Finwhcyl[n] == \"Yes\"){\n    energy$tank[n] <- \"Tank with Immersion Heater\"\n    if(is.na(energy$Finwsiag[n])){\n      energy$immersage[n] <- energy$Finwdiag[n]\n    }else{\n      energy$immersage[n] <- energy$Finwsiag[n]\n    }\n  }else if((energy$Finwsipr[n] == \"No\" && energy$Finwdipr[n] == \"No\") && energy$Finwhcyl[n] == \"Yes\"){\n    energy$tank[n] <- \"Tank without Immersion Heater\"\n  }else{\n    energy$tank[n] <- \"No Tank\"\n  }\n}\n\n#Remove Unneeded Columns\nrems <- !names(energy) %in% c(\"Finwsipr\",\"Finwdipr\",\"Finwhcyl\",\"Finwdiag\",\"Finwsiag\")\nenergy <- energy[,rems]\n\n#Plot\ncounts <- table(energy$tank)\nbarplot(counts, main=\"Water Tank Type\", ylab=\"Number of Dwellings\")\n\n#Simplify Tank insualtion\nenergy$tankins <- NA\nenergy$Finwhmms <- as.character(energy$Finwhmms)\nenergy$Finwhmms <- rem_na(energy$Finwhmms)\nfor(c in 1:nrow(energy)){\n  if(energy$Finwhmms[c] == \"150 mm\" | energy$Finwhmms[c] == \"100 mm\" | energy$Finwhmms[c] == \"80 mm\"){\n    energy$tankins[c] <-\"Well Insulated\"\n  } else if (energy$Finwhmms[c] == \"12.5mm\" | energy$Finwhmms[c] == \"25 mm\" | energy$Finwhmms[c] == \"38 mm\" | energy$Finwhmms[c] == \"50 mm\"){\n    energy$tankins[c] <-\"Poorly Insulated\"\n  } else {\n    energy$tankins[c] <-\"No Insulation\"\n  }\n}\n\n#Plot\ncounts <- table(energy$tankins)\nbarplot(counts, main=\"Water Tank Type\", ylab=\"Number of Dwellings\")\n\n#Remove Unneeded Columns\nrems <- !names(energy) %in% c(\"Finwhmms\",\"Finwhins\")\nenergy <- energy[,rems]\n\n\n#Simplify Instaneous Heater\nenergy$Finwmppr <- rem_na(energy$Finwmppr) #Mulitpoint\nenergy$Finwsppr <- rem_na(energy$Finwsppr) #Single Point\n\nenergy$instant <- NA\nfor(o in 1:nrow(energy)){\n  if(energy$Finwmppr[o] == \"Yes\" && energy$Finwsppr[o] == \"Yes\"){\n    energy$instant[o] <- \"Yes\"\n  }else if(energy$Finwmppr[o] == \"No\" && energy$Finwsppr[o] == \"Yes\"){\n    energy$instant[o] <- \"Yes\"\n  }else if(energy$Finwmppr[o] == \"Yes\" && energy$Finwsppr[o] == \"No\"){\n    energy$instant[o] <- \"Yes\"\n  }else{\n    energy$instant[o] <- \"No\"\n  }\n}\n\n#Remove Unneeded Columns\nrems <- !names(energy) %in% c(\"Finwmppr\",\"Finwsppr\")\nenergy <- energy[,rems]\n\n#Plot\ncounts <- table(energy$instant)\nbarplot(counts, main=\"Instaneous Water Heater\", ylab=\"Number of Dwellings\")\n\n\nlevels(energy$Finchtyp) <- c(levels(energy$Finchtyp),\"No Answer\")\n\n#Clean Main ones\nfor(q in 1:nrow(energy)){\n  if(is.na(energy$Finmhboi[q])){\n    energy$Finmhboi[q] <- \"No boiler\"\n  }\n  if(is.na(energy$Finchtyp[q])){\n    energy$Finchtyp[q] <- \"No Answer\"\n  }\n  \n}\n\n#Clean Fuels\nenergy$mainfuel <- as.character(energy$mainfuel)\nfor(g in 1:nrow(energy)){\n  if(energy$mainfuel[g] == \"bulk LPG\" | energy$mainfuel[g] == \"bottled gas - propane\"){\n    energy$mainfuel[g] <- \"gas (other)\"\n  }else if(energy$mainfuel[g] == \"house coal\" | energy$mainfuel[g] == \"smokeless fuel\" | energy$mainfuel[g] == \"anthracite nuts\" | energy$mainfuel[g] == \"anthracite grains\"){\n    energy$mainfuel[g] <- \"coal\"\n  }else if(energy$mainfuel[g] ==\"electricity (7 hr. on peak)\" | energy$mainfuel[g] == \"electricity (7 hr. off peak)\" | energy$mainfuel[g] ==  \"electricity (standard tariff)\" | energy$mainfuel[g] ==  \"electricity (10 hr. on peak)\" | energy$mainfuel[g] == \"electricity (10 hr. off peak)\" | energy$mainfuel[g] == \"electricity (24 hr heating tariff)\"){\n    energy$mainfuel[g] <- \"electricity\"\n  }\n}\nenergy$mainfuel <- as.factor(energy$mainfuel)\n\n#Plot\ncounts <- table(energy$mainfuel)\nbarplot(counts, main=\"Heater Fuel\", ylab=\"Number of Dwellings\")\n\n#Mulit-row per dwelling tables\n######################################################################\n#Doors Table\n######################################################################\ndoors <- read.spss(paste0(infld,\"physical/doors.sav\"),to.data.frame=TRUE)\ndoors <- doors[,c(\"aacode\",\"type\",\"Fexdf1no\",\"Fexdf1ag\",\n                                  \"Fexdf2no\",\"Fexdf2ag\")]\ndoors <- doors[doors$Fexdf1no > 0 | doors$Fexdf2no > 0 ,]\ndoors$number <- doors$Fexdf1no + doors$Fexdf2no\nsummary((doors$Fexdf1ag != doors$Fexdf2ag) & (doors$Fexdf1no != 0 | doors$Fexdf2no != 0)) #2/3 have the same age front and back when accounting for only on front or back\n\n#Remove NAs\nrem_na_0 <- function(col){\n  for(x in 1:length(col)){\n    if(is.na(col[x])){\n      col[x]<- 0\n    }\n  } \n  return(col)\n}\ndoors$Fexdf1ag <- rem_na_0(doors$Fexdf1ag)\ndoors$Fexdf2ag <- rem_na_0(doors$Fexdf2ag)\ndoors$age <- pmax(doors$Fexdf1ag,doors$Fexdf2ag)\n\n#Remove Unneeded Columns\nrems <- !names(doors) %in% c(\"Fexdf1ag\",\"Fexdf2ag\",\"Fexdf1no\",\"Fexdf2no\")\ndoors <- doors[,rems]\ndoors <- reshape(doors, direction = \"wide\", idvar=\"aacode\", timevar=\"type\")\n\ndoors$number.Wood <- rem_na_0(doors$number.Wood)\ndoors$number.UPVC <- rem_na_0(doors$number.UPVC)\ndoors$number.Metal <- rem_na_0(doors$number.Metal)\ndoors$age.Wood <- rem_na_0(doors$age.Wood)\ndoors$age.UPVC <- rem_na_0(doors$age.UPVC)\ndoors$age.Metal <- rem_na_0(doors$age.Metal)\n\ndoors$doornumb <- doors$number.Wood + doors$number.UPVC + doors$number.Metal\ndoors$doorage <- pmax(doors$age.Wood, doors$age.UPVC, doors$age.Metal)\n\ndoors <- doors[,c(\"aacode\",\"doornumb\",\"doorage\")]\n\n################################################################################\n#Windows Table\n#############################################################################\nwindows <- read.spss(paste0(infld,\"physical/windows.sav\"),to.data.frame=TRUE)\nwindows <- windows[,c(\"aacode\",\"type\",\"Fexwn1no\",\"Fexwn1ag\",\n                                      \"Fexwn2no\",\"Fexwn2ag\")]\nwindows <- windows[windows$Fexwn1no > 0 | windows$Fexwn2no > 0,]\n\nwindows$numb <- windows$Fexwn1no + windows$Fexwn2no\nsummary((windows$Fexwn1ag != windows$Fexwn2ag) & (windows$Fexwn1no != 0 | windows$Fexwn2no != 0)) #2/3 have the same age front and back when accounting for only on front or back\n\nwindows$Fexwn1ag <- rem_na_0(windows$Fexwn1ag)\nwindows$Fexwn2ag <- rem_na_0(windows$Fexwn2ag)\nwindows$age <- pmax(windows$Fexwn1ag,windows$Fexwn2ag)\n\n#Remove Unneeded Columns\nrems <- !names(windows) %in% c(\"Fexwn1ag\",\"Fexwn2ag\",\"Fexwn1no\",\"Fexwn2no\")\nwindows <- windows[,rems]\nwindows <- reshape(windows, direction = \"wide\", idvar=\"aacode\", timevar=\"type\")\n\nwindows$`numb.Double-glazed- wood`  <- rem_na_0(windows$`numb.Double-glazed- wood`)  \nwindows$`age.Double-glazed- wood` <- rem_na_0(windows$`age.Double-glazed- wood`)\nwindows$`numb.Double-glazed- UPVC` <- rem_na_0(windows$`numb.Double-glazed- UPVC`)\nwindows$`age.Double-glazed- UPVC` <- rem_na_0(windows$`age.Double-glazed- UPVC`)\nwindows$`numb.Single-glazed- UPVC` <- rem_na_0(windows$`numb.Single-glazed- UPVC`)\nwindows$`age.Single-glazed- UPVC` <- rem_na_0(windows$`age.Single-glazed- UPVC`)\nwindows$`numb.Single-glazed- wood casement` <- rem_na_0(windows$`numb.Single-glazed- wood casement`)\nwindows$`age.Single-glazed- wood casement`  <- rem_na_0(windows$`age.Single-glazed- wood casement`)\nwindows$`numb.Double-glazed- metal`  <- rem_na_0(windows$`numb.Double-glazed- metal`)\nwindows$`age.Double-glazed- metal`  <- rem_na_0(windows$`age.Double-glazed- metal`)\nwindows$`numb.Single-glazed- wood sash` <- rem_na_0(windows$`numb.Single-glazed- wood sash`)\nwindows$`age.Single-glazed- wood sash` <- rem_na_0(windows$`age.Single-glazed- wood sash`)\nwindows$`numb.Single-glazed- metal` <- rem_na_0(windows$`numb.Single-glazed- metal`)\nwindows$`age.Single-glazed- metal` <- rem_na_0(windows$`age.Single-glazed- metal`)\n\nwindows$dblglaze <- windows$`numb.Double-glazed- wood` + windows$`numb.Double-glazed- UPVC` + windows$`numb.Double-glazed- metal`\nwindows$dblglazeage <- pmax(windows$`age.Double-glazed- wood`,windows$`age.Double-glazed- UPVC`,windows$`age.Double-glazed- metal`)\nwindows$sngglaze <- windows$`numb.Single-glazed- UPVC` + windows$`numb.Single-glazed- wood casement` + windows$`numb.Single-glazed- wood sash` + windows$`numb.Single-glazed- metal`\nwindows$sngglazeage <- pmax(windows$`age.Single-glazed- UPVC`,windows$`age.Single-glazed- wood casement`,windows$`age.Single-glazed- wood sash`,windows$`age.Single-glazed- metal`)\n\n#Remove Unneeded Columns\nwindows <- windows[,c(\"aacode\",\"dblglaze\",\"dblglazeage\",\"sngglaze\",\"sngglazeage\")]\n\n#####################################################################\n#Join back into a master table\n###################################################################\ncombined_2013 <- left_join(context,shape, by = \"aacode\")\ncombined_2013 <- left_join(combined_2013,walls, by = \"aacode\")\ncombined_2013 <- left_join(combined_2013,roof, by = \"aacode\")\ncombined_2013 <- left_join(combined_2013,windows, by = \"aacode\")\ncombined_2013 <- left_join(combined_2013,doors, by = \"aacode\")\ncombined_2013 <- left_join(combined_2013,energy, by = \"aacode\")\n\ncombined_2013$LoftIns <- as.factor(combined_2013$LoftIns)\n\nremove(context,doors,elevate,general,physical,roof,services,shape, walls, windows)\n\n#Gas Available\n\ncombined_2013$gasgrid <- NA\n\nfor (f in 1:nrow(combined_2013)){\n  if(combined_2013$mainfuel[f] == \"gas (mains)\"){\n    combined_2013$gasgrid[f] <- \"yes\"\n  }else if(combined_2013$arnatx[f] == \"city centre\" | combined_2013$arnatx[f] == \"other urban centre\"| combined_2013$arnatx[f] == \"suburban residential\"){\n    combined_2013$gasgrid[f] <- \"yes\"\n  }else{\n    combined_2013$gasgrid[f] <- \"no\"\n  }\n}\n\n\n#Save Out\n\nsaveRDS(combined_2013,\"data/combined_2013_base.Rds\")\n\n\n\n\n",
    "created" : 1492526795722.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3697775436",
    "id" : "32A9239B",
    "lastKnownWriteTime" : 1492527639,
    "path" : "C:/Users/earmmor/Git/glider/Glider/code/ehs2rds.R",
    "project_path" : "code/ehs2rds.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}