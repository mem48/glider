{
    "contents" : "# To find siliar artchitypes\ncomb <- readRDS(\"data/combined_2013_arch.Rds\")\nsel <- comb[,c(\"aacode\",\"aagpd1213\",\"archcode\",\"energytyp\",\"generaltyp\",\"rooftyp\",\"solartyp\",\"walltyp\",\"wintyp\",\"floortyp\")]\n\nsel <- sel[with(sel, order(rooftyp,solartyp,walltyp,wintyp,floortyp)),]\nuni <- as.data.frame(unique(sel[,c(\"archcode\",\"energytyp\",\"generaltyp\",\"rooftyp\",\"solartyp\",\"walltyp\",\"wintyp\",\"floortyp\")]))\n\n\ncomp <- matrix(nrow = nrow(uni), ncol = nrow(uni))\ncomp <- as.data.frame(comp)\nnames(comp) <- uni$archcode\nrownames(comp) <- uni$archcode\n\nnrow <- length(uni$archcode)\nncell <-  nrow ** 2\n\ny_last = 1\n\nfor(i in 1:ncell){\n  x <- if(i %% nrow == 0){nrow}else{i %% nrow}\n  y <- ((i-1) %/% nrow) + 1\n  if(y != y_last){print(paste0(\"Doing column \",y,\" of \",nrow,\" at \",Sys.time()))}\n  yid <- colnames(comp)[y]\n  xid <- rownames(comp)[x]\n  xval <- uni[uni$archcode == xid,]\n  yval <- uni[uni$archcode == yid,]\n  comp[x,y] <- sum(xval$energytyp == yval$energytyp, xval$generaltyp == yval$generaltyp, xval$rooftyp == yval$rooftyp, xval$solartyp == yval$solartyp, xval$walltyp == yval$walltyp, xval$wintyp == yval$wintyp, xval$floortyp == yval$floortyp)\n  y_last <- y\n}\n\n#comp$V1858 <- NULL #Don't know why this happend\nsaveRDS(comp,\"data/archetypes_comparion2.Rds\")\nrm(nrow,ncell,x,y,yid,xid,xval,yval,y_last, uni, sel, i)\n#stop()\n\n#Sort by count then group with simialr architypes\nrowcount <- data.frame(id = names(comp), sum=rowSums(comp)) #This one for editing\ngroups <- data.frame(id = names(comp), sum=rowSums(comp) ,group=NA, ndwel=NA) # this one to store\nrowcount <- rowcount[order(-rowcount$sum),] # Sort\ngroups$id <- as.character(groups$id)\n\n#Add in the numebr of dwellings\nfor(b in 1:nrow(groups)){\n  groups$ndwel[b] <- sum(comb$aagpd1213[comb$archcode == groups$id[b]]) \n}\nrm(b)\n\n#Group the Architypes\nfor(a in 1:99999){\n  id <- as.character(rowcount$id[1])\n  sub <- as.data.frame(comp[,id, drop = FALSE])\n  names(sub) <- c(\"res\")\n  sub <- sub[sub$res >=6,,drop = FALSE]\n  getids <- rownames(sub)\n  groups$group[groups$id %in% getids] <- a\n  rowcount <- rowcount[!(rowcount$id %in% getids),]\n  if(nrow(rowcount) == 0){\n    break\n  }\n}\nrm(a, id,sub, getids)\n\n\n\n\n#Count the number of dwellings in each group\ngroupsums <- data.frame(group = groups$group[!duplicated(groups$group)], ndwel = NA)\nfor(c in 1:nrow(groupsums)){\n  groupsums$ndwel[c] <- sum(groups$ndwel[groups$group == groupsums$group[c]])\n}\nrm(c)\n\ngroupsums <- groupsums[order(-groupsums$ndwel),]\n\ncsum <- cumsum(groupsums$ndwel)\nplot(csum, ylab = \"Number of Houses\", xlab = \"Number of Archetype Groups\")\n\n#Add in architype codes\ngroupsums$arch <- NA\nfor(d in 1:nrow(groupsums)){\n  groupsums$arch[d] <- groups$id[groups$group == groupsums$group[d]][1]\n}\n\n\n#uni$count <- NA\n#uni$countsamp <- NA\n#uni$conf <- NA\n#for (f in 1:nrow(uni)){\n#  uni$count[f] <- sum(sel$aagpd1213[sel$archcode == uni$archcode[f] ])\n#  uni$countsamp[f] <- nrow(sel[sel$archcode == uni$archcode[f]  , ])\n#  uni$conf[f] <- uni$count[f] / uni$countsamp[f]\n#}\n\n\n\n\n\n",
    "created" : 1495024604679.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1855217580",
    "id" : "4DE15AEF",
    "lastKnownWriteTime" : 1495470666,
    "path" : "C:/Users/earmmor/Git/glider/Glider/code/similar_archetypes.R",
    "project_path" : "code/similar_archetypes.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}