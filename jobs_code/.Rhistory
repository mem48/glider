source('D:/Users/earmmor/GitHub/glider/jobs_code/calc_adoption_curves.R', echo=TRUE)
arch <- readRDS("../jobs_data/archetype_summary_retrofitopts.Rds")
comb <- readRDS("../jobs_data/combined_2013_arch.Rds")
retro.ops <- read.csv("../jobs_data/retrofit_options.csv")
years <- as.character(2013:2050)
retro.ops[years] <- 0
retro.ops$k <- 0
retro.ops$x0 <- 0
retro.ops$'2013'[retro.ops$Measure == "Internal Solid Wall Insulation"] <- sum(comb$aagpd1213[comb$wallinsy == "solid with insulation"])/2
retro.ops$'2013'[retro.ops$Measure == "External Solid Wall Insulation"] <- sum(comb$aagpd1213[comb$wallinsy == "solid with insulation"])/2
retro.ops$'2050'[retro.ops$Measure == "Internal Solid Wall Insulation"] <- sum(comb$aagpd1213[comb$wallinsy %in% c("solid with insulation", "solid uninsulated","other") ])/2
retro.ops$'2050'[retro.ops$Measure == "External Solid Wall Insulation"] <- sum(comb$aagpd1213[comb$wallinsy %in% c("solid with insulation", "solid uninsulated","other") ])/2
retro.ops$'2013'[retro.ops$Measure == "Cavity Wall Insulation"] <- sum(comb$aagpd1213[comb$wallinsy == "cavity with insulation"])
retro.ops$'2050'[retro.ops$Measure == "Cavity Wall Insulation"] <- sum(comb$aagpd1213[comb$wallinsy %in% c("cavity with insulation", "cavity uninsulated") ])
retro.ops$'2013'[retro.ops$Measure == "Loft Insulation"] <- sum(comb$aagpd1213[comb$LoftIns == "Well Insulated" & comb$rooftyp == "A" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2050'[retro.ops$Measure == "Loft Insulation"] <- sum(comb$aagpd1213[comb$LoftIns %in% c("Poorly Insulated","Well Insulated","No Insulation") & comb$rooftyp == "A" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2013'[retro.ops$Measure == "Room in roof insulation"] <- sum(comb$aagpd1213[comb$LoftIns == "Well Insulated" & comb$rooftyp == "B" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2050'[retro.ops$Measure == "Room in roof insulation"] <- sum(comb$aagpd1213[comb$LoftIns %in% c("Poorly Insulated","Well Insulated","No Insulation") & comb$rooftyp == "B" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2013'[retro.ops$Measure == "Flat roof insulation"] <- sum(comb$aagpd1213[comb$LoftIns == "Well Insulated" & comb$rooftyp == "C" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2050'[retro.ops$Measure == "Floor Insulation Solid"] <- sum(comb$aagpd1213[comb$floortyp == "A" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2013'[retro.ops$Measure == "Floor Insulation Solid"] <- sum(comb$aagpd1213[comb$floortyp == "A" & comb$generaltyp %in% c("A","B","C","F")])/100 #No data assume 1% uptake
retro.ops$'2050'[retro.ops$Measure == "Flat roof insulation"] <- sum(comb$aagpd1213[comb$LoftIns %in% c("Poorly Insulated","Well Insulated","No Insulation") & comb$rooftyp == "C" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2050'[retro.ops$Measure == "Floor Insulation Suspended"] <- sum(comb$aagpd1213[comb$floortyp == "B" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2013'[retro.ops$Measure == "Floor Insulation Suspended"] <- sum(comb$aagpd1213[comb$floortyp == "B" & comb$generaltyp %in% c("A","B","C","F")])/100 #not data so assume 1% uptake
retro.ops$'2013'[retro.ops$Measure == "new or replacement windows"] <- sum(comb$aagpd1213[comb$floortyp == "A" & comb$winage == "0 -10 years"])
retro.ops$'2050'[retro.ops$Measure == "new or replacement windows"] <- sum(comb$aagpd1213)
retro.ops$'2013'[retro.ops$Measure == "solar photovoltaics"] <- sum(comb$aagpd1213[comb$solartyp == "A" & comb$PV == "Yes" & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2050'[retro.ops$Measure == "solar photovoltaics"] <- sum(comb$aagpd1213[comb$solartyp == "A" & comb$PV %in% c("Yes","No") & comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2013'[retro.ops$Measure == "solar water heating"] <- sum(comb$aagpd1213[comb$solartyp == "A" &
comb$Solar == "Yes" &
comb$energytyp %in% c("B","C","E") &
comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2050'[retro.ops$Measure == "solar water heating"] <- sum(comb$aagpd1213[comb$solartyp == "A" &
comb$Solar %in% c("Yes","No") &
comb$energytyp %in% c("B","C","E") &
comb$generaltyp %in% c("A","B","C","F")])
retro.ops$'2013'[retro.ops$Measure == "heating controls"] <- sum(comb$aagpd1213[comb$control == 7])
retro.ops$'2050'[retro.ops$Measure == "heating controls"] <- sum(comb$aagpd1213) # All dwellings need some from of heating controls
retro.ops$'2013'[retro.ops$Measure == "air source heat pump"] <- 1000 # no data so assume 1000
retro.ops$'2050'[retro.ops$Measure == "air source heat pump"] <- sum(comb$aagpd1213) * 0.3
retro.ops$'2013'[retro.ops$Measure == "ground source heat pump"] <- 1000 # no data so assume 1000
retro.ops$'2050'[retro.ops$Measure == "ground source heat pump"] <- sum(comb$aagpd1213) * 0.1
retro.ops$'2013'[retro.ops$Measure == "district heating connection"] <- sum(comb$aagpd1213[comb$energytyp == "G"]) # communal heating not quite the same a distric heating
retro.ops$'2050'[retro.ops$Measure == "district heating connection"] <- sum(comb$aagpd1213) * 0.07
retro.ops$'2013'[retro.ops$Measure == "Boiler replacements"] <- sum(comb$aagpd1213[comb$energytyp %in% c("A","B","C","H")])
retro.ops$'2050'[retro.ops$Measure == "Boiler replacements"] <- sum(comb$aagpd1213) * 0.46
retro.ops$'2013'[retro.ops$Measure == "Electric storage heater replacement"] <- sum(comb$aagpd1213[comb$energytyp == "D"]) #storage heater not quite the same as resistive
retro.ops$'2050'[retro.ops$Measure == "Electric storage heater replacement"] <- sum(comb$aagpd1213) * 0.07
retro.ops$'2013'[retro.ops$Measure == "Hot water cylinder insulation"] <- sum(comb$aagpd1213[comb$tankins == "Well Insulated" ])
retro.ops$'2050'[retro.ops$Measure == "Hot water cylinder insulation"] <- sum(comb$aagpd1213[comb$tankins %in% c("Poorly Insulated","No Insulation","Well Insulated") ])
cal.uptake <- function(L,k,x,x0){
res <- L / (1 + (exp(1) ** (-k * (x - x0) )))
return(res)
}
cal.downtake <- function(L,k,x,x0){
res <- L / (1 + (exp(1) ** (k * (x - x0) )))
return(res)
}
get.uptake <- function(measure){
#http://www.clear-lines.com/blog/post/S-shaped-market-adoption-curve.aspx
rownumb <- which(retro.ops$Measure == measure)
L <- retro.ops[rownumb,"2050"]
y2013 <- retro.ops[rownumb,"2013"]
k <- (log(L/y2013 - 1) - log(L/(0.99*L) - 1))/(2050 - 2013)
x0 <- log(L/y2013 - 1)/k + 2013
message(measure," ",round(x0,2)," ",round(k,2))
for(i in 2014:2049){
sub <- round(cal.uptake(L,k,x = i,x0),0)
if(i == 2014){
res <- sub
}else{
res <- c(res,sub)
}
}
#Bind 2050, k , x0 on to the end
res <- c(res,L,k,x0)
return(res)
}
linear.uptake <- function(measure){
rownumb <- which(retro.ops$Measure == measure)
L <- retro.ops[rownumb,"2050"]
y2013 <- retro.ops[rownumb,"2013"]
diff <- (L - y2013)/(2050 - 2013)
res <- list()
for(i in 2014:2049){
if(i == 2014){
res[[i]] <- round(y2013 + diff,0)
}else{
sub <- round(res[[i-1]] + diff,0)
if(sub > L){
res[[i]] <- L
}else{
res[[i]] <- sub
}
}
}
res <- unlist(res)
res <- c(res,L,NA,NA)
return(res)
}
neg.scurve <- function(measure){
#http://www.clear-lines.com/blog/post/S-shaped-market-adoption-curve.aspx
rownumb <- which(retro.ops$Measure == measure)
L <- retro.ops[rownumb,"2013"]
y2013 <- retro.ops[rownumb,"2050"]
k <- (log(L/y2013 - 1) - log(L/(0.99*L) - 1))/(2050 - 2013)
x0 <- log(L/y2013 - 1)/k + 2050
message(measure," ",round(x0,2)," ",round(k,2))
for(i in 2014:2049){
sub <- round(cal.downtake(L,k,x = i,x0),0)
if(i == 2014){
res <- sub
}else{
res <- c(res,sub)
}
}
#Bind 2050, k , x0 on to the end
res <- c(res,y2013,k,x0)
return(res)
}
for(i in 1:nrow(retro.ops)){
measure <- retro.ops$Measure[i]
method <- retro.ops$Model[i]
if(method == "scurve"){
retro.ops[retro.ops$Measure == measure, c(years[2:38],"k","x0") ] <- get.uptake(measure)
}else if(method == "linear"){
retro.ops[retro.ops$Measure == measure, c(years[2:38],"k","x0") ] <- linear.uptake(measure)
}else if(method == "negcurve"){
retro.ops[retro.ops$Measure == measure, c(years[2:38],"k","x0") ] <- neg.scurve(measure)
}
}
boiler.vals <- c(19417213, 19328446,	19325990,	19318648,	19305860,	19287005,	19261401,	19228300,	19186889,	19136279,	19075513,	19003558,
18919310,	18821596,	18709184,	18580785,	18435075,	18270706,	18086334,	17880645,	17652388,	17400420,	17123746,	16821569,
16493349,	16138852,	15758205,	15351943,	14921051,	14466988,	13991703,	13497627,	12987642,	12465034,	11933426,	11396682,	10858810,	10696739)
retro.ops[retro.ops$Measure == "Boiler replacements", years[1:38] ] <- boiler.vals
foo <- retro.ops[retro.ops$'2014' != 0,c("Measure",years)]
df <- melt(foo)#the function melt reshapes it from wide to long
df$Measure <- NULL
df$rowid <- foo$Measure  #add a rowid identifying variable
head(df)
ggplot(df, aes(variable, value, group=factor(rowid))) + geom_line(aes(color=factor(rowid)), size = 2)
rates.df <- retro.ops[,1:3]
for(j in 2:38){
rt <- retro.ops[,years[j]] - retro.ops[,years[j-1]]
rates.df[,years[j]] <- rt
}
foo2 <- rates.df[rates.df$'2014' != 0,c("Measure",years[2:38])]
df <- melt(foo2)#the function melt reshapes it from wide to long
df$Measure <- NULL
df$rowid <- foo$Measure  #add a rowid identifying variable
head(df)
ggplot(df, aes(variable, value, group=factor(rowid))) + geom_line(aes(color=factor(rowid)), size = 2)
saveRDS(df,"../twitter_data/refrofit_rates.Rds")
rates <- readRDS("../jobs_data/refrofit_rates.Rds")
View(rates)
source('D:/Users/earmmor/GitHub/glider/jobs_code/calc_adoption_curves.R', echo=TRUE)
source('D:/Users/earmmor/GitHub/glider/jobs_code/calc_adoption_curves.R', echo=TRUE)
View(rates.df)
rates <- readRDS("../jobs_data/refrofit_rates.Rds")
